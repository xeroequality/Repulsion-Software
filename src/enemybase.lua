----------------------------------------------------------
-- enemybase.lua
-- Contains table of values that represent the enemy's base.
----------------------------------------------------------
local Materials = require("materials")
local Units = require("units")
W = display.contentWidth
H = display.contentHeight

EnemyBase = {}
enemyGroup = display.newGroup()
enemyMaterialGroup = display.newGroup()
enemyUnitGroup = display.newGroup()

EnemyBase.level1 = {
	numObjects=7,
	baseX=700,
	baseY=291.5510559082,
	totalCost=900,
	id={
2,2,2,2,1,2,1000
},
x_vals={
86.931579589844,0,1.1129150390625,74.110504150391,37.576263427734,37.563232421875,28.450836181641
},
y_vals={
-3.0002746582031,-3.020751953125,-39.476623535156,-39.459259033203,-23.949493408203,-45.899627685547,0
},
scaleX={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046
},
scaleY={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046
},
rotations={
-0.00011647020437522,-0.0029062614776194,-0.0054930117912591,-180.10137939453,-0.0008417708449997,-0.0021360637620091,-0.0001947150885826
}
}

EnemyBase.level2 = {
	numObjects=13,
	baseX=700,
	baseY=302.5466003418,
	totalCost=2900,
id={
2,2,2,2,1,2,2,1,1,1,1000,1000,1000
},
x_vals={
175.98481750488,87.244094848633,87.53483581543,167.74000549316,124.33686828613,130.46357727051,0,6.1998291015625,44.568588256836,144.76884460449,115.76332092285,28.721939086914,159.14814758301
},
y_vals={
-3.0406188964844,-3.0406799316406,-39.54655456543,-39.503875732422,-23.850372314453,-45.662475585938,-3.0406494140625,-24.990356445313,-23.990325927734,-81.926315307617,0,-0.040618896484375,-72.964248657227
},
scaleX={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046
},
scaleY={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046
},
rotations={
6.0195619880687e-005,1.6232939969996e-006,0.11313401162624,-179.9759979248,0.28460532426834,0.61385834217072,0.00016539021453355,0.00024236389435828,0.00025132703012787,-89.38306427002,0.046419076621532,7.7957934990991e-005,0.018521830439568
}
}

EnemyBase.level3 = {
	numObjects=13,
	baseX=700,
	baseY=291.56558227539,
	totalCost=2550,
id={
3,3,3,3,2,2,2,2,2,2,1,1000,1000
},
x_vals={
0,0.15200805664063,1.1989440917969,2.0612945556641,25.661758422852,28.714218139648,27.720718383789,29.010940551758,66.350540161133,112.42601013184,87.124801635742,54.376419067383,107.35688781738
},
y_vals={
-3.0837097167969,-39.598007202148,-76.080871582031,-112.54071044922,-2.994384765625,-39.432647705078,-75.873611450195,-112.31781005859,-38.44970703125,-38.457855224609,-60.445922851563,0,-6.103515625e-005
},
scaleX={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046
},
scaleY={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046
},
rotations={
89.824951171875,89.576889038086,89.752670288086,89.795036315918,0.0054391976445913,0.013802671805024,0.018501903861761,0.02115723490715,-1.6256159142358e-005,0.024300614371896,-0.042150136083364,-6.7237167968415e-005,1.7130052583525e-005
}
}

EnemyBase.level4 = {
	numObjects=25,
	baseX=700,
	baseY=291.55462646484,
	totalCost=3325,
id={
4,4,4,2,2,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,2,2,1000,1000,1000
},
x_vals={
119.60491943359,98.215927124023,99.024505615234,77.332931518555,75.583618164063,140.24847412109,171.11943054199,156.94044494629,141.20797729492,174.44906616211,158.28820800781,199.57051086426,199.41777038574,200.79789733887,124.74383544922,36.331436157227,0,4.0809478759766,38.249053955078,36.284515380859,284.16865539551,284.15821838379,223.78330993652,55.486480712891,17.658508300781
},
y_vals={
0,-43.015151977539,-6.5205383300781,-6.4847412109375,-42.933868408203,-6.4781799316406,-6.4773254394531,-27.927734375,-49.379608154297,-49.395065307617,-70.878479003906,-6.4786071777344,-42.928863525391,-64.416687011719,-22.015197753906,-30.928741455078,-6.4843139648438,-38.804992675781,-56.89176940918,-93.313385009766,-6.4772033691406,-42.92692565918,-3.4893188476563,-76.375396728516,-3.4772033691406
},
scaleX={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046
},
scaleY={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046
},
rotations={
389.69381713867,628.16229248047,269.20791625977,-0.02366915717721,-0.023777332156897,270.0168762207,90.000480651855,0.0022194012999535,90.026741027832,91.450103759766,-0.15440519154072,89.974891662598,269.96722412109,1.2565393447876,125.72370910645,0.0028402691241354,89.945976257324,-27.965030670166,85.36075592041,85.421104431152,1.3753459825239e-005,0.00010095509060193,-0.068547055125237,-0.023841319605708,1.2468980457925e-005
}
}

EnemyBase.level5 = {
	numObjects=36,
	baseX=700,
	baseY=291.55462646484,
	totalCost=6655,
id={
3,3,3,3,5,5,5,5,5,5,5,3,3,3,2,2,2,2,2,2,2,2,2,2,5,1,1,5,2,2,1000,1000,1000,1000,1000,1000
},
x_vals={
46.32975769043,83.004135131836,120.0179901123,156.48667907715,36.394668579102,87.515213012695,62.971099853516,127.87477111816,110.63635253906,167.03245544434,152.53971862793,62.379165649414,99.2548828125,137.27272033691,0,1.7242584228516,1.3882598876953,0.82852172851563,0.9847412109375,199.93211364746,200.48036193848,200.71357727051,199.66468811035,200.71440124512,60.085342407227,67.669418334961,104.18110656738,104.13342285156,200.33256530762,0.47883605957031,70.673721313477,238.75526428223,238.43919372559,238.39985656738,238.3494720459,237.29121398926
},
y_vals={
-0.0076904296875,-0.00994873046875,0,-0.0098876953125,-25.481872558594,-15.543090820313,-31.625427246094,-25.488891601563,-32.021087646484,-27.137145996094,-35.399658203125,-47.115478515625,-46.818222045898,-50.926849365234,-11.012481689453,-47.462127685547,-83.911895751953,-120.36178588867,-156.81167602539,-11.014739990234,-47.464294433594,-83.914108276367,-120.36360168457,-156.81364440918,-105.48954772949,-93.556579589844,-93.85693359375,-115.79965209961,-193.26345825195,-193.26162719727,-69.636138916016,-8.0113830566406,-43.460235595703,-78.909790039063,-114.35958862305,-149.80937194824
},
scaleX={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046
},
scaleY={
0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.16666667163372,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046,0.40000000596046
},
rotations={
0.0039754309691489,0.0057113338261843,-0.026271183043718,-0.0010820323368534,-0.17372803390026,116.74809265137,63.260925292969,0.10933142155409,59.833431243896,10.41015625,63.540573120117,-0.17437522113323,-3.5750052928925,0.10471697151661,0.002327770460397,0.0027175664436072,0.0029317087028176,0.0031087258830667,0.00326979579404,-0.0099456394091249,-0.010747235268354,-0.0113928290084,-0.011839542537928,-0.012180567719042,-117.05113220215,-0.48707240819931,-0.4555324614048,-0.45149874687195,-0.012340256944299,0.003333845641464,-0.48694139719009,5.4833082685946e-005,0.00014588517660741,0.00017514810315333,0.00018264798563905,0.00020454307377804
}
}

EnemyBase.loadBase = function(level)
	local physics = require("physics")
	local UI = require("module_item_ui")
	
	for i=1,level.numObjects do
		local obj = {}
		local enemyCollisionFilter = { categoryBits = 4, maskBits = 5 }
		if level.id[i] < 1000 then
			obj = Materials.clone(level.id[i])
			enemyMaterialGroup:insert(obj)
			obj.x = level.baseX + level.x_vals[i]
			obj.y = level.baseY + level.y_vals[i]
			obj.rotation = level.rotations[i]
			physics.addBody(obj, "dynamic", { friction=obj.friction, bounce=obj.bounce, density=obj.density, shape=obj.shape, filter=enemyCollisionFilter })
			obj:addEventListener("postCollision",UI.hit);
			enemyGroup:insert(enemyMaterialGroup)
		elseif level.id[i] >= 1000 then
			obj = Units.clone(level.id[i])
			enemyUnitGroup:insert(obj)
			obj.x = level.baseX + level.x_vals[i];
			obj.y = level.baseY + level.y_vals[i];
			obj.rotation = level.rotations[i]
			physics.addBody( obj, "dynamic",
				{ density=obj.objDensity, friction=obj.objFriction, bounce=obj.objBounce, shape=obj.objShape, filter=enemyCollisionFilter },
				{ density=obj.objBaseDensity, friction=obj.objBaseFriction, bounce=obj.objBaseBounce, shape=obj.objBaseShape, filter=enemyCollisionFilter }
			)
			obj:addEventListener("postCollision",UI.hit);
			enemyGroup:insert(enemyUnitGroup)
		end
	end
	return enemyGroup
end

EnemyBase.destroy = function()
	local tmp = enemyMaterialGroup.numChildren
	while tmp >= 1 do
		enemyMaterialGroup:remove(tmp)
		tmp = tmp - 1
	end
	enemyMaterialGroup = display.newGroup()
	tmp = enemyUnitGroup.numChildren
	while tmp >= 1 do
		enemyUnitGroup:remove(tmp)
		tmp = tmp - 1
	end
	enemyUnitGroup = display.newGroup()
	enemyGroup = display.newGroup()
end

return EnemyBase